class KlaviyoFormComponent extends HTMLElement {
    constructor() {
      super();
    }
  
    connectedCallback() {
      this.form = this.querySelector('.form-klaviyo-newsletter');
      this.form.addEventListener('submit', this.onSubmit.bind(this));
    }
  
    onSubmit(event) {
      event.preventDefault();
      // Add any additional logic or validation here
      const emailInput = this.form.querySelector('input[name="contact[email]"]').value;
  
      const url = 'https://a.klaviyo.com/client/subscriptions/?company_id=VX8mak';
  
      const data = {
        data: {
          type: "subscription",
          attributes: {
            list_id: "WfCnpp",
            email: emailInput,
          }
        }
      };
  
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Revision': '2023-06-15'
        },
        body: JSON.stringify(data)
      })
        .then(data => {
          if(data.ok){
            this.querySelector('.form_on_success').style.display = "block";
            this.querySelector('.fieldset-with-submit').style.display = "none";
          }
          else{
            this.querySelector('.form_on_danger').style.display = "block";
            const submitButton = this.form.querySelector('button[type="submit"]');
  
          }
        })
        .catch(errors => {
          this.querySelector('form-klaviyo-newsletter .form_on_danger').style.display = "block";
          const submitButton = this.form.querySelector('button[type="submit"]');
          submitButton.setAttribute('aria-busy', 'false');
        });
    }
  }
  
  customElements.define('form-klaviyo-newsletter', KlaviyoFormComponent);



  class StripePaymentButtonsComponent extends HTMLElement {
    constructor() {
      super();
    }
  
    connectedCallback() {
      this.buttons = this.querySelectorAll('.btn');
      
      
      const updateButtonOptions = ({detail}) => {
        console.log(this.buttons)
        if(this.buttons){
          this.buttons.forEach(button => {
            if(button.getAttribute('data-variant-id')==detail.variant.id){
              button.style.display = 'initial';
            }
            else{
              button.style.display = 'none';
            }
          })
        }
      }

      document.addEventListener('theme:variant:change', updateButtonOptions);
    }
  }

  customElements.define('stripe-payment-buttons', StripePaymentButtonsComponent);